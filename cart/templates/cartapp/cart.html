{% extends 'base.html' %}


{% block content %}
<div class="product-block233">
    {% if empty != 'true' %}
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Modal title</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form method="post">
                            {% csrf_token %}
                            <input type="text" name="name" hidden value="buy">
                            <input type="text" name="UserName" placeholder="Input your name">
                            <input type="email" name="email" placeholder="Input your email">
                            <div class="modal-footer">
                                <button type="submit"  class="btn btn-primary">Buy</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <button type="button" class="button-modal" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
            Place an order
        </button>
    {% endif %}
    
        <div class="products-idi-b-bulkydgfuiuicbbhgyzgufgbhhjyuvxtvdfVJHNGgyuFgnmbhgzyyfyugHJchhcFYctuyGH">
            {% for product in products %}
                <div class="products-1337zxczxczxczxczxczxczxczxczxczxczxczxczxczxczxczxczxczxczxczxczxczxc">
                    <p>{{ product.name }}</p>
                    <p>{{ product.price }} $</p>
                    <p>{{ product.cost }}</p>
                    <form method="POST" class="delet_from_cart">
                        {% csrf_token %}
                        <input type="hidden" name="product_pk" id="product_pk" value="{{ product.pk }}">
                        <button class="button-delete-from-cart" id="button-delete-from-cart">Delete from cart</button>
                    </form>
                </div>
            {% endfor %}

            {% if empty == 'true' %}
                <h3 style="color: black;">Your cart is empty</h3>
                <a style="color: rgb(30, 81, 146); text-decoration: none;" href="../catalogue">You can click here to redirect to the cart</a>
            {% endif %}
        </div>

        
    </div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
      $('#button-delete-from-cart').click(function(event) {
        event.preventDefault();
  
        let productId = $('#product_pk').val();
        
        let url = '/cart/';
  
        $.ajax({
          type: "POST",
          url: url,
          data: {
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            'product_pk': productId,
          },
          success: function(response) {
            // Успешное выполнение запроса
            console.log("Product deleted from cart:", response);
  
            // Дополнительные действия после удаления продукта (если необходимо)
          },
          error: function(xhr, errmsg, err) {
            // Обработка ошибок при выполнении запроса (если необходимо)
            console.log(xhr.status + ": " + xhr.responseText);
          }
        });
      });
    });
</script>
{% endblock %}
